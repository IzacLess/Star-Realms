<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Star Realms - Score Helper</title>

  <!-- Russo One -->
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#05060a;
      --panel:#0f1720;
      --glass: rgba(255,255,255,0.03);
      --accent-green: #3CF06E;
      --accent-red: #FF3B3B;
      --accent-yellow: #FFD34D;
      --accent-grey: #9aa0a6;
      --accent-blue: #4DA3FF;
      --text: #ffffff;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);font-family:'Russo One',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;color:var(--text);-webkit-tap-highlight-color:transparent;}
    /* starfield behind everything */
    canvas#starfield{position:fixed;inset:0;z-index:0;display:block}
    /* fireworks canvas above UI */
    canvas#fireworks{position:fixed;inset:0;z-index:6;pointer-events:none}

    /* app layout: two halves */
    .app{position:relative;z-index:2;display:flex;height:100vh;width:100vw;align-items:stretch;}
    .half{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:1.6vh 3vw;position:relative;overflow:hidden;border-left:1px solid rgba(255,255,255,0.03)}
    .half:first-child{border-left:none}

    /* active glow around whole half (soft & subtle) */
    .half.active{
      box-shadow: inset 0 0 120px rgba(77,163,255,0.06), 0 0 0 6px rgba(77,163,255,0.02);
      transition: box-shadow .35s ease;
    }

    /* If flipped (player 2), rotate whole half 180deg */
    .half.flip{transform:rotate(180deg);}

    /* Player title */
    .title{font-size:clamp(0.9rem,1.6vw,1.4rem);letter-spacing:1px;margin-bottom:0.6vh;color:rgba(255,255,255,0.92)}

    /* Authority headline - fixed headline size but responsive */
    .authority{
      display:flex;align-items:center;gap:1.2ch;
      margin:0.6vh 0 2vh 0;
    }
    .authority .label{color:var(--accent-green);font-size:clamp(0.9rem,1.8vw,1.2rem);opacity:0.95}
    .authority .value{
      font-size:clamp(3.6rem,11vw,7.2rem); /* headline size (fixed-ish) */
      line-height:1;
      color:#fff;
      text-shadow:0 0 18px rgba(60,240,110,0.22);
      -webkit-text-stroke: 0.8px rgba(0,0,0,0.4);
    }

    /* grid 2x2 */
    .grid{width:100%;max-width:560px;display:grid;grid-template-columns:1fr 1fr;gap:1.4vh 3vw;align-items:stretch;justify-items:stretch}

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:14px;padding:1.6vh 1.2vw;display:flex;flex-direction:column;align-items:center;justify-content:center;
      min-height:calc(10vh + 6vw);
      box-shadow: 0 8px 20px rgba(0,0,0,0.6), inset 0 0 14px rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.04);
    }
    .card .heading{font-size:clamp(0.9rem,1.8vw,1.3rem);margin-bottom:0.8vh;letter-spacing:1px}
    .card .value{font-size:clamp(1.6rem,4.6vw,3rem);margin-bottom:0.8vh}

    /* button row - minus left, plus right */
    .btn-row{display:flex;align-items:center;justify-content:space-between;width:100%;gap:1vw}
    .btn{
      flex:0 0 46%; /* ensures big tap targets, scales with container */
      display:inline-flex;align-items:center;justify-content:center;
      height:calc(5.6vh + 1vw);
      border-radius:10px;background:rgba(0,0,0,0.35);border:1px solid rgba(255,255,255,0.06);color:var(--text);
      font-size:clamp(1rem,2.6vw,1.6rem);cursor:pointer;box-shadow:0 6px 10px rgba(0,0,0,0.5);
      user-select:none;
    }
    .btn:active{transform:scale(.98)}

    /* End / Attack button (bottom-right cell) - we make it stretch and prominent */
    .end-card{display:flex;align-items:center;justify-content:center}
    .end-btn{
      width:100%;height:100%;border-radius:12px;background:var(--accent-red);color:white;font-size:clamp(1.2rem,3vw,1.6rem);
      border:none;cursor:pointer;box-shadow:0 10px 28px rgba(255,59,59,0.18);padding:0.8rem;
    }
    .end-btn.attack{box-shadow:0 12px 36px rgba(255,59,59,0.30);outline:3px solid rgba(255,59,59,0.06)}
    .end-btn:active{transform:scale(.98)}

    /* small fullscreen button top-right */
    .fs-btn{
      position:fixed;right:8px;top:8px;z-index:8;background:rgba(255,255,255,0.06);border-radius:8px;padding:6px 8px;font-size:1.05rem;border:none;color:var(--text);cursor:pointer;
      backdrop-filter: blur(4px);
    }
    .fs-btn:active{transform:scale(.98)}
    .fs-btn:hover{background:rgba(255,255,255,0.12)}

    /* winner overlay */
    #overlay{
      position:fixed;inset:0;z-index:5;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.65);
      color:white;flex-direction:column;padding:4vh;
    }
    #overlay h1{font-size:clamp(2.6rem,8vw,5rem);margin:0 0 1vh 0;text-align:center}
    #overlay .sub{font-size:clamp(1rem,2.2vw,1.4rem);opacity:0.9;margin-bottom:2vh}
    #overlay .new{padding:0.9rem 1.4rem;border-radius:10px;background:var(--panel);border:1px solid rgba(255,255,255,0.06);font-size:1.05rem}

    /* ensure tap targets large on very small screens */
    @media (max-width:520px){
      .btn{flex-basis:44%}
      .card{min-height:calc(14vh + 6vw)}
    }
  </style>
</head>
<body>

  <!-- starfield behind everything -->
  <canvas id="starfield"></canvas>

  <!-- fireworks canvas sits above UI (z-index greater) -->
  <canvas id="fireworks"></canvas>

  <!-- small fullscreen button -->
  <button class="fs-btn" id="fsBtn" aria-label="toggle fullscreen">⛶</button>

  <div class="app" id="app">
    <!-- Player 1 -->
    <section class="half" id="p1">
      <div class="title">PLAYER 1</div>
      <div class="authority" aria-hidden="false">
        <div class="label" style="color:var(--accent-green)">AUTHORITY</div>
        <div class="value" id="p1-authority">50</div>
      </div>

      <div class="grid">
        <!-- Combat -->
        <div class="card">
          <div class="heading" style="color:var(--accent-red)">COMBAT</div>
          <div class="value" id="p1-combat">0</div>
          <div class="btn-row">
            <button class="btn btn-minus" data-player="p1" data-type="combat" data-delta="-1">−</button>
            <button class="btn btn-plus"  data-player="p1" data-type="combat" data-delta="1">+</button>
          </div>
        </div>

        <!-- Trade -->
        <div class="card">
          <div class="heading" style="color:var(--accent-yellow)">TRADE</div>
          <div class="value" id="p1-trade">0</div>
          <div class="btn-row">
            <button class="btn btn-minus" data-player="p1" data-type="trade" data-delta="-1">−</button>
            <button class="btn btn-plus"  data-player="p1" data-type="trade" data-delta="1">+</button>
          </div>
        </div>

        <!-- Discards -->
        <div class="card">
          <div class="heading" style="color:var(--accent-grey)">DISCARDS</div>
          <div class="value" id="p1-discards">0</div>
          <div class="btn-row">
            <button class="btn btn-minus" data-player="p1" data-type="discards" data-delta="-1">−</button>
            <button class="btn btn-plus"  data-player="p1" data-type="discards" data-delta="1">+</button>
          </div>
        </div>

        <!-- End / Attack (bottom-right) -->
        <div class="card end-card">
          <button id="p1-end" class="end-btn">END TURN</button>
        </div>
      </div>
    </section>

    <!-- Player 2 (flipped for across the table) -->
    <section class="half flip" id="p2">
      <div class="title">PLAYER 2</div>
      <div class="authority">
        <div class="label" style="color:var(--accent-green)">AUTHORITY</div>
        <div class="value" id="p2-authority">50</div>
      </div>

      <div class="grid">
        <!-- Combat -->
        <div class="card">
          <div class="heading" style="color:var(--accent-red)">COMBAT</div>
          <div class="value" id="p2-combat">0</div>
          <div class="btn-row">
            <button class="btn btn-minus" data-player="p2" data-type="combat" data-delta="-1">−</button>
            <button class="btn btn-plus"  data-player="p2" data-type="combat" data-delta="1">+</button>
          </div>
        </div>

        <!-- Trade -->
        <div class="card">
          <div class="heading" style="color:var(--accent-yellow)">TRADE</div>
          <div class="value" id="p2-trade">0</div>
          <div class="btn-row">
            <button class="btn btn-minus" data-player="p2" data-type="trade" data-delta="-1">−</button>
            <button class="btn btn-plus"  data-player="p2" data-type="trade" data-delta="1">+</button>
          </div>
        </div>

        <!-- Discards -->
        <div class="card">
          <div class="heading" style="color:var(--accent-grey)">DISCARDS</div>
          <div class="value" id="p2-discards">0</div>
          <div class="btn-row">
            <button class="btn btn-minus" data-player="p2" data-type="discards" data-delta="-1">−</button>
            <button class="btn btn-plus"  data-player="p2" data-type="discards" data-delta="1">+</button>
          </div>
        </div>

        <!-- End / Attack -->
        <div class="card end-card">
          <button id="p2-end" class="end-btn">END TURN</button>
        </div>
      </div>
    </section>
  </div>

  <!-- Winner overlay (fireworks show in front) -->
  <div id="overlay" role="dialog" aria-modal="true">
    <h1 id="overlay-text">PLAYER X WINS!</h1>
    <div class="sub">Tap New Game to reset</div>
    <button class="new" id="new-game">NEW GAME</button>
  </div>

  <!-- Audio placeholders (you can replace by putting your files in /sounds/ and changing src) -->
  <audio id="s-click" preload="auto" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
  <audio id="s-end"   preload="auto" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
  <audio id="s-win"   preload="auto" src="https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg"></audio>

<script>
/* ===========================
   State & helpers
   =========================== */
let state = {
  current: 'p1', // 'p1' or 'p2'
  p1: {authority:50, combat:0, trade:0, discards:0},
  p2: {authority:50, combat:0, trade:0, discards:0},
  winner: null
};
const el = id => document.getElementById(id);
const play = id => { const a = el(id); if(!a) return; try{ a.currentTime=0; a.play(); }catch(e){} };

/* ===========================
   Render UI based on state
   =========================== */
function render(){
  // values
  el('p1-authority').textContent = Math.max(0, state.p1.authority);
  el('p2-authority').textContent = Math.max(0, state.p2.authority);
  el('p1-combat').textContent = Math.max(0, state.p1.combat);
  el('p1-trade').textContent = Math.max(0, state.p1.trade);
  el('p1-discards').textContent = Math.max(0, state.p1.discards);
  el('p2-combat').textContent = Math.max(0, state.p2.combat);
  el('p2-trade').textContent = Math.max(0, state.p2.trade);
  el('p2-discards').textContent = Math.max(0, state.p2.discards);

  // active half glow
  document.querySelectorAll('.half').forEach(h => h.classList.remove('active'));
  el(state.current).classList.add('active');

  // End buttons: show Attack & End Turn when current player's combat > 0
  ['p1','p2'].forEach(p=>{
    const btn = el(p+'-end');
    const combat = state[p].combat;
    const isCurrent = (state.current === p);
    if (combat > 0) {
      btn.textContent = 'ATTACK AND END TURN';
      btn.classList.add('attack');
    } else {
      btn.textContent = 'END TURN';
      btn.classList.remove('attack');
    }
    // visually disable button if not current player (still visible but won't act)
    btn.style.opacity = isCurrent ? '1' : '0.6';
    btn.style.pointerEvents = isCurrent ? 'auto' : 'auto'; // keep clickable but handler checks current
  });
}

/* ===========================
   Adjust counters (clamped)
   =========================== */
function clamp(n){ return Math.max(0, n|0); }

function changeStat(player, type, delta){
  // Only combat/trade/discards constrained to >=0; authority shouldn't be increased via buttons in this UI
  if (!['combat','trade','discards'].includes(type)) return;
  state[player][type] = clamp(state[player][type] + delta);
  // sound for taps
  play('s-click');
  render();
}

/* attach plus/minus handlers (event delegation) */
document.addEventListener('click', e=>{
  const b = e.target.closest('.btn');
  if(!b) return;
  const player = b.getAttribute('data-player');
  const type = b.getAttribute('data-type');
  const delta = parseInt(b.getAttribute('data-delta') || 0, 10);
  changeStat(player, type, delta);
});

/* ===========================
   End turn / attack logic
   =========================== */
function endTurnFor(player){
  if (state.current !== player) {
    // ignore end if not current (prevents accidental ending other player's turn)
    play('s-click'); // slight feedback
    return;
  }
  play('s-end');

  const opponent = (player === 'p1') ? 'p2' : 'p1';
  const combat = state[player].combat;
  if (combat > 0) {
    // Apply combat to opponent's authority
    state[opponent].authority = state[opponent].authority - combat;
    // ensure not NaN
    if (isNaN(state[opponent].authority)) state[opponent].authority = 0;
  }

  // Reset current player's per-turn counters
  state[player].combat = 0;
  state[player].trade = 0;
  state[player].discards = 0;

  // After applying combat, check win
  if (state[opponent].authority <= 0) {
    // attacker (player) wins
    state.winner = player;
    showWinner(player);
  } else {
    // switch turn to opponent
    state.current = opponent;
  }
  render();
}

/* wire end buttons */
el('p1-end').addEventListener('click', ()=> endTurnFor('p1'));
el('p2-end').addEventListener('click', ()=> endTurnFor('p2'));

/* ===========================
   Winner overlay & New Game
   =========================== */
function showWinner(attacker){
  const winnerText = attacker === 'p1' ? 'PLAYER 1 WINS!' : 'PLAYER 2 WINS!';
  el('overlay-text').textContent = winnerText;
  el('overlay').style.display = 'flex';
  play('s-win');
  startFireworks(); // start looping fireworks in front
}

el('new-game').addEventListener('click', ()=>{
  // reset state
  state = {
    current: 'p1', p1:{authority:50, combat:0, trade:0, discards:0}, p2:{authority:50, combat:0, trade:0, discards:0}, winner:null
  };
  el('overlay').style.display = 'none';
  stopFireworks();
  render();
});

/* ===========================
   Fullscreen toggle
   =========================== */
const fsBtn = el('fsBtn');
fsBtn.addEventListener('click', toggleFullscreen);
function toggleFullscreen(){
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().catch(()=>{/* ignore */});
  } else {
    document.exitFullscreen().catch(()=>{/* ignore */});
  }
}

/* ===========================
   Starfield (slow drifting)
   =========================== */
const starCanvas = el('starfield');
const sctx = starCanvas.getContext('2d');
let stars = [];
function resizeStar(){
  starCanvas.width = innerWidth;
  starCanvas.height = innerHeight;
  // regen stars density relative to viewport
  const area = starCanvas.width * starCanvas.height;
  const count = Math.max(80, Math.min(420, Math.floor(area / 6000)));
  stars = Array.from({length:count}, () => ({
    x: Math.random()*starCanvas.width,
    y: Math.random()*starCanvas.height,
    r: Math.random()*1.6 + 0.2,
    a: Math.random()*0.6 + 0.15,
    dx: (Math.random()-0.5) * 0.2,
    dy: (Math.random()-0.5) * 0.2,
    tw: Math.random() * Math.PI * 2
  }));
}
window.addEventListener('resize', resizeStar);
resizeStar();

function drawStars(){
  sctx.clearRect(0,0,starCanvas.width, starCanvas.height);
  for (const s of stars){
    s.x += s.dx; s.y += s.dy; s.tw += 0.01;
    if (s.x < 0) s.x = starCanvas.width;
    if (s.x > starCanvas.width) s.x = 0;
    if (s.y < 0) s.y = starCanvas.height;
    if (s.y > starCanvas.height) s.y = 0;
    const alpha = Math.max(0.05, Math.min(1, s.a + Math.sin(s.tw) * 0.12));
    sctx.fillStyle = `rgba(255,255,255,${alpha})`;
    sctx.beginPath(); sctx.arc(s.x, s.y, s.r, 0, Math.PI*2); sctx.fill();
  }
  requestAnimationFrame(drawStars);
}
drawStars();

/* ===========================
   Fireworks (front layer)
   - looping while overlay visible
   =========================== */
const fwCanvas = el('fireworks');
const fctx = fwCanvas.getContext('2d');
let fwParticles = [];
let fwInterval = null;
function resizeFW(){ fwCanvas.width = innerWidth; fwCanvas.height = innerHeight; }
window.addEventListener('resize', resizeFW); resizeFW();

function spawnFirework(){
  const x = Math.random() * fwCanvas.width * 0.86 + fwCanvas.width*0.07;
  const y = Math.random() * fwCanvas.height * 0.5 + fwCanvas.height*0.08;
  const hue = Math.floor(Math.random() * 360);
  const count = 80 + Math.floor(Math.random()*40);
  for (let i=0;i<count;i++){
    const angle = Math.random() * Math.PI * 2;
    const speed = 1.2 + Math.random()*4;
    fwParticles.push({
      x, y,
      vx: Math.cos(angle) * speed,
      vy: Math.sin(angle) * speed,
      life: 60 + Math.random()*60,
      hue, alpha:1
    });
  }
}

let fwRunning = false;
function drawFW(){
  if(!fwRunning) return;
  fctx.clearRect(0,0,fwCanvas.width, fwCanvas.height);
  for (let i=fwParticles.length-1;i>=0;i--){
    const p = fwParticles[i];
    p.x += p.vx; p.y += p.vy; p.vy += 0.02; p.vx *= 0.995;
    p.life -= 1; p.alpha = Math.max(0, p.life / 140);
    fctx.fillStyle = `hsla(${p.hue},100%,60%,${p.alpha})`;
    fctx.fillRect(p.x, p.y, 2, 2);
    if (p.life <= 0) fwParticles.splice(i,1);
  }
  requestAnimationFrame(drawFW);
}

function startFireworks(){
  if (fwRunning) return;
  fwRunning = true;
  spawnFirework();
  fwInterval = setInterval(spawnFirework, 700);
  drawFW();
}
function stopFireworks(){
  fwRunning = false;
  clearInterval(fwInterval);
  fwParticles = [];
  fctx.clearRect(0,0,fwCanvas.width, fwCanvas.height);
}

/* ===========================
   Init / boot
   =========================== */
render();

/* optionally: expose state for debugging in console */
window.__srState = state;
</script>
</body>
</html>
